{% extends 'layout.html' %} {% block body %}

<div class="form-container dashboard-container">
    <h1>Articles dashboard</h1>

    <div>
        <div class="create-new-article-container">
            <h2>Create a new article</h2>
            <div class="button-container">
                <button onclick="location.href='/dashboard/add_article'" type="button">Add Article</button>
            </div>
        </div>

        <h2>Existing articles</h2>
        {% if articles %}
        <table class="dashboard-table">
            <tr>
                <th>ID</th>
                <th>Title</th>
                <th>Author</th>
                <th>Date</th>
                <th></th>
                <th></th>
            </tr>
            {% for article in articles %}
            <tr>
                <td>{{article.id}}</td>
                <td>{{article.title}}</td>
                <td>{{article.author}}</td>
                <td>{{article.created_at}}</td>
                <td>
                    <div class="button-container">
                        <button onclick="location.href='/dashboard/edit_article/{{article.id}}'" type="button">Edit</button>
                    </div>
                <td>
                    <div class="button-container">
                        <button onclick="deleteArticle({{article.id}})" type="button" class="button-negative">Delete</button>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </table>
        {% else %}
        <p>{{ msg or "No articles found" }}</p>
        {% endif %}
    </div>

</div>

<script>
function deleteArticle(articleId) {
    if (confirm('Are you sure you want to delete this article?')) {
        fetch(`/api/articles/${articleId}`, {
            method: 'DELETE',
            credentials: 'include'
        })
        .then(response => {
            if (response.ok) {
                location.reload();
            } else {
                alert('Failed to delete article');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Failed to delete article');
        });
    }
}
</script>
{% endblock %}